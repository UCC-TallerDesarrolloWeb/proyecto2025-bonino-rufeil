<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Carrito – La Mística</title>
  <link rel="stylesheet" href="styles.css"/>
  <meta name="author" content="Joaquin Bonino, Demetrio Rufeil, Santino Vercesi" />
  <meta name="description" content="Menú de hamburguesas clásicas, dobles y triples." />
  <meta name="keywords" content="hamburguesas, menú, clásica, doble, triple" />
</head>
<body>

    <header>
    <div class="container-hero">
      <div class="container hero">
        <div class="customer-support">
            <img class="icon-headset" src="img/auriculares-con-microfono.png" alt="Soporte al cliente" />
            <div class="content-customer-support">
            <span class="text">Soporte al cliente</span>
            <span class="number">+351-567-0876</span>
          </div>
        </div>

        <div class="container-logo">
          <img src="img/hamburguer.png" alt="Logo empresa" />
          <h1 class="logo"><a href="index.html">La Mistica</a></h1>
        </div>

        <div class="container-user">
          <img src="img/user.png" alt="Usuario" />

          <div class="content-shopping-cart">
            <img src="img/shopping-cart.png" alt="Carrito de compras" />
            <span class="text">Carrito</span>
            <span class="number-products" aria-live="polite">0</span>
          </div>
        </div>
      </div>
    </div>

    <nav class="container-navbar">
        <nav class="navbar container">
        <img src="img/menu.png" alt="Abrir menú" />

      <ul class="menu">
        <li><a href="index.html">Inicio</a></li>
        <li><a href="menu.html" aria-current="page">Hamburguesas</a></li>
        <li><a href="sucursales.html">Dónde encontrarnos</a></li>
      </ul>

      <form class="search-form">

        <input type="search" placeholder="Buscar..."/>
    <button class="btn-search">
      <img src="img/lupa.png" alt="Buscar" />
    </button>
      </form>
    </div>
  </header>

    <main class="container" style="padding:2rem 0;">
    <h2 style="text-align:center; margin:2rem 0;">Tu Orden</h2>
    <section id="cart-box" style="max-width:820px; margin:0 auto; background:#fff; border-radius:1rem; padding:2rem; box-shadow:0 2px 8px rgba(0,0,0,.06);">
        <table id="cart-table" style="width:100%; border-collapse:collapse;">
        <thead>
            <tr>
            <th style="text-align:left; padding:.75rem 1rem; font-weight:700;">Tipo</th>
            <th style="text-align:center; padding:.75rem 1rem; font-weight:700;">Cantidad</th>
            <th style="text-align:right; padding:.75rem 1rem; font-weight:700;">Precio</th>
            </tr>
        </thead>
        <tbody id="cart-tbody">
        </tbody>
        <tfoot>
            <tr>
            <td style="padding:1rem 1rem; font-weight:700;">Total</td>
            <td></td>
            <td id="cart-total" style="text-align:right; padding:1rem 1rem; font-weight:700;">0</td>
            </tr>
        </tfoot>
        </table>
        <p id="cart-empty" style="display:none; text-align:center; margin:1rem 0 0 0;">Tu carrito está vacío.</p>
    </section>
    </main>


  <script>
    document.addEventListener('DOMContentLoaded', function(){
      try{
        var cart = JSON.parse(localStorage.getItem('cart') || '[]');
        var totalQty = 0;
        for(var i=0;i<cart.length;i++){ totalQty += (parseInt(cart[i].qty,10)||0); }
        var badge = document.querySelector('.number-products');
        if(badge){ badge.textContent = totalQty; }
      }catch(e){}
    });
  </script>

  <script>
  function fmt(n){ try{ return new Intl.NumberFormat('es-AR').format(n); }catch(_){ return n; } }

  // agrupa por nombre sumando cantidades (conserva precio unitario del ítem)
  function compactCart(items){
    var map = {}; // name -> {name, price, qty}
    for(var i=0;i<items.length;i++){
      var it = items[i];
      var key = String(it.name);
      if(!map[key]) map[key] = { name: key, price: Number(it.price)||0, qty: 0 };
      map[key].qty += Number(it.qty)||0;
      // si vinieran con precios distintos por error, dejamos el último
      map[key].price = Number(it.price)||map[key].price;
    }
    return Object.values(map).filter(function(x){ return x.qty>0; });
  }

  function renderCartTable(){
    var tbody = document.getElementById('cart-tbody');
    var totalEl = document.getElementById('cart-total');
    var emptyMsg = document.getElementById('cart-empty');

    // limpia
    tbody.innerHTML = '';
    totalEl.textContent = '0';

    // lee carrito
    var raw = [];
    try{ raw = JSON.parse(localStorage.getItem('cart') || '[]'); }catch(e){ raw = []; }

    var items = compactCart(raw);

    if(!items.length){
      emptyMsg.style.display = 'block';
      return;
    } else {
      emptyMsg.style.display = 'none';
    }

    var total = 0;
    for(var i=0;i<items.length;i++){
      var it = items[i];
      var tr = document.createElement('tr');

      var tdName = document.createElement('td');
      tdName.textContent = it.name;
      tdName.style.padding = '.75rem 1rem';

      var tdQty = document.createElement('td');
      tdQty.textContent = it.qty;
      tdQty.style.textAlign = 'center';
      tdQty.style.padding = '.75rem 1rem';

      var tdPrice = document.createElement('td');
      tdPrice.textContent = fmt(it.price);
      tdPrice.style.textAlign = 'right';
      tdPrice.style.padding = '.75rem 1rem';

      tr.appendChild(tdName);
      tr.appendChild(tdQty);
      tr.appendChild(tdPrice);
      tbody.appendChild(tr);

      total += (Number(it.price)||0) * (Number(it.qty)||0);
    }

    totalEl.textContent = fmt(total);

    var badge = document.querySelector('.number-products');
    if(badge){
      var totalQty = items.reduce(function(acc, x){ return acc + (Number(x.qty)||0); }, 0);
      badge.textContent = totalQty;
    }
  }

  document.addEventListener('DOMContentLoaded', renderCartTable);
</script>

<style>
  #cart-box table th,
  #cart-box table td {
    font-size: 1.25rem; 
  }

  #cart-box h2,
  #cart-box td#cart-total {
    font-size: 1.4rem;
  }

  #cart-box {
    line-height: 1.6;
  }
</style>


<script>
// Menú hamburguesa para móviles
document.addEventListener('DOMContentLoaded', function() {
  var btnMenu = document.querySelector('.navbar img[alt="Abrir menú"]');
  var menu = document.querySelector('.menu');
  function checkMenuDisplay() {
    if (window.innerWidth <= 768) {
      btnMenu.style.display = 'block';
      menu.style.display = 'none';
      menu.style.flexDirection = '';
      menu.style.position = '';
      menu.style.top = '';
      menu.style.right = '';
      menu.style.width = '';
      menu.style.backgroundColor = '';
      menu.style.padding = '';
    } else {
      btnMenu.style.display = 'none';
      menu.style.display = 'flex';
      menu.style.flexDirection = 'row';
      menu.style.position = '';
      menu.style.top = '';
      menu.style.right = '';
      menu.style.width = '';
      menu.style.backgroundColor = '';
      menu.style.padding = '';
    }
  }
  checkMenuDisplay();
  window.addEventListener('resize', checkMenuDisplay);
  btnMenu.addEventListener('click', function() {
    if (menu.style.display === 'none') {
      menu.style.display = 'flex';
      menu.style.flexDirection = 'column';
      menu.style.position = 'absolute';
      menu.style.top = '100%';
      menu.style.right = '0';
      menu.style.width = '200px';
      menu.style.backgroundColor = '#d8b97f';
      menu.style.padding = '1rem';
    } else {
      menu.style.display = 'none';
    }
  });
});
</script>
</html>
